version: '3.8'

services:
  openclaw-gateway:
    image: ghcr.io/openclaw/openclaw:2026.2.26@sha256:ce9347548afa0b6bdd1d262060535ba04baf0b19cde0fc211c8039492647d1b1
    container_name: openclaw-gateway
    restart: unless-stopped
    command: ["node", "openclaw.mjs", "gateway", "--allow-unconfigured", "--bind", "lan"]
    ports:
      - "127.0.0.1:18789:18789"
    environment:
      - OPENCLAW_DEFAULT_MODEL=ollama/qwen2.5:14b
      - OPENCLAW_GATEWAY_TOKEN=${OPENCLAW_GATEWAY_TOKEN}
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
    volumes:
      - /ssd/fast_storage/docker/openclaw/config:/home/node/.openclaw
      - /ssd/fast_storage/docker/openclaw/workspace:/home/node/openclaw/workspace
      - /var/run/docker.sock:/var/run/docker.sock
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.openclaw.rule=Host(`claw.tylercash.dev`) && (ClientIP(`10.0.0.0/8`) || ClientIP(`172.19.0.0/24`))"
      - "traefik.http.routers.openclaw.entrypoints=websecure"
      - "traefik.http.routers.openclaw.tls.certresolver=leresolver"
      - "traefik.http.services.openclaw.loadbalancer.server.port=18789"
    networks:
      - homelab_default

  ollama:
    image: ollama/ollama:latest
    container_name: ollama
    restart: unless-stopped
    volumes:
      - /ssd/fast_storage/docker/ollama:/root/.ollama
    environment:
      - OLLAMA_HOST=0.0.0.0
      - OLLAMA_NUM_PARALLEL=1
    entrypoint: ["/bin/sh", "-c", "ollama serve & sleep 5 && ollama pull qwen2.5:14b && wait"]
    networks:
      - homelab_default

networks:
  homelab_default:
    external: true
